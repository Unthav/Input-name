<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Owner: Submitted Names</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding:24px; background:#f3f4f6; }
    h1 { margin-top:0; }
    table { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,0.06); }
    th, td { padding:12px 16px; border-bottom:1px solid #eee; text-align:left; }
    th { background:#fafafa; font-weight:600; }
    .small { color:#666; font-size:13px; }
    .actions { margin:10px 0; }
    button { padding:8px 12px; border-radius:6px; border:0; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Submitted names</h1>
  <div class="actions">
    <button id="refresh">Refresh</button>
  </div>
  <div id="list">Loading…</div>

  <script>
    async function load() {
      const container = document.getElementById('list');
      container.textContent = 'Loading…';
      try {
        const res = await fetch('/api/names', { credentials: 'same-origin' });
        if (!res.ok) {
          container.textContent = 'Unable to fetch names (are you authenticated?)';
          return;
        }
        const json = await res.json();
        const arr = json.data || [];
        if (!arr.length) {
          container.innerHTML = '<p class="small">No names yet.</p>';
          return;
        }
        let html = '<table><thead><tr><th>#</th><th>Name</th><th>Submitted At (UTC)</th></tr></thead><tbody>';
        arr.slice().reverse().forEach((e, i) => {
          html += `<tr><td>${i+1}</td><td>${escapeHtml(e.name)}</td><td class="small">${escapeHtml(e.submittedAt)}</td></tr>`;
        });
        html += '</tbody></table>';
        container.innerHTML = html;
      } catch (e) {
        container.textContent = 'Network error';
      }
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    document.getElementById('refresh').addEventListener('click', load);
    load();
  </script>
</body>
</html>